name: Update Quote of the Day

on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight UTC
  workflow_dispatch: # Allows manual triggering from the Actions tab

jobs:
  update-quote:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up environment
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Fetch and process quote
        run: |
          # Fetch the quote of the day
          QUOTE_JSON=$(curl -s https://zenquotes.io/api/today)
          
          # Parse the quote and author
          QUOTE=$(echo "$QUOTE_JSON" | jq -r '.[0].q')
          AUTHOR=$(echo "$QUOTE_JSON" | jq -r '.[0].a')

          # Create a new quote section
          NEW_QUOTE_SECTION="### ðŸ’¡ Quote of the Day\n\n_$QUOTE_ â€“ $AUTHOR\n"

          # Read the current README file
          README_FILE="README.md"
          CONTENT=$(cat $README_FILE)

          # Remove the old quote section
          UPDATED_CONTENT=$(echo "$CONTENT" | sed -e '/### ðŸ’¡ Quote of the Day/,+3d')

          # Add the new quote section
          UPDATED_CONTENT=$(echo "$UPDATED_CONTENT" | sed -e "s|### ðŸ’¡ Quote of the Day|${NEW_QUOTE_SECTION}### ðŸ’¡ Quote of the Day|")

          # Write the updated content back to the README file
          echo "$UPDATED_CONTENT" > $README_FILE

      - name: Commit and push changes
        run: |
          git config --local user.name "${{ secrets.GIT_USERNAME }}"
          git config --local user.email "${{ secrets.GIT_EMAIL }}"
          git add README.md
          git commit -m "Update quote of the day"
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
